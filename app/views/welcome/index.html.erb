<div class="panel panel-default">

  <div class="panel-body">
      <table class="table table-bordered">
         <caption>问题分析</caption>
         <thead>
            <tr>
               <th rowspan="2">领域</th>
               <th rowspan="2">问题总数</th>
               <th colspan="5">完成情况</th>
               <th colspan="8">业务问题</th>
               <th rowspan="2">B系统问题</th>
               <th rowspan="2">C系统优化</th>
               <th rowspan="2">D需求新增</th>
               <th rowspan="2">E操作问题</th>
               <th rowspan="2">F接口修改</th>
               <th rowspan="2">G处内协调</th>
               <th rowspan="2">H报表新增</th>
               <th rowspan="2">I电源</th>
               <th rowspan="2">J设备故障</th>
               <th rowspan="2">K网络</th>
               <th rowspan="2">J其它</th>
               <th colspan="3">问题级别</th>
            </tr>
            <tr>
                <th>A已结案</th>
                <th>B已完成</th>
                <th>C处理中</th>
                <th>D方案研讨中</th>
                <th>E已反馈</th>
                <th>A1数据下载</th>
                <th>A2请示报告</th>
                <th>A3问题协调</th>
                <th>A4业务授权</th>
                <th>A5业务咨询</th>
                <th>A6修改数据</th>
                <th>A7删除数据</th>
                <th>A8导入数据</th>
                <th>A紧急</th>
                <th>B重要</th>
                <th>C普通</th>
            </tr>
         </thead>
         <tbody>
             <% WorkOneType.all.each do |type| %>
                 <tr>
                     <td>
                         <%= type.name %>
                     </td>
                     <td>
                         <%= type.work_sheets.count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_status2 => 'A已结案').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_status2 => 'B已完成').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_status2 => 'C处理中').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_status2 => 'D方案研讨中').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_status2 => 'E已反馈').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A1数据下载').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A2请示报告').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A3问题协调').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A4业务授权').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A5业务咨询').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A6修改数据').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A7删除数据').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'A8导入数据').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'B系统问题').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'C系统优化').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'D需求新增').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'E操作问题').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'F接口修改').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'G处内协调').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'H报表新增').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'I电源').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'J设备故障').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'K网络').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_mode => 'Z其它').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_rate => 'A频繁').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_rate => 'B经常').count %>
                     </td>
                     <td>
                         <%= type.work_sheets.where(:work_rate => 'C很少').count %>
                     </td>
                 </tr>
             <% end %>
         </tbody>
      </table>
  </div>
</div>


<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">所有问题</h3>
  </div>
  <div class="panel-body">
      <table class="table">
          <thead>
              <th>
                  日期
              </th>
              <th>
                  受理人
              </th>
              <th>
                  处理人
              </th>
              <th>
                  发生地点
              </th>
              <th>
                  工作类别
              </th>
              <th>
                  处理状态
              </th>
              <th>
                  问题描述
              </th>
              <th>
                  处理结果
              </th>
          </thead>
          <tbody>
              <% @work_sheets.each do |sheet| %>
                <tr>
                    <td style="width:11%">
                        <%= sheet.work_datetime.strftime("%y-%m-%d %H:%M") %>
                    </td>
                    <td style="width:6%">
                        <%= sheet.username %>
                    </td>
                    <td style="width:6%">
                        <%= sheet.user.name%>
                    </td>
                    <td style="width:7%">
                        <%= sheet.work_place %>
                    </td>
                    <td style="width:7%">
                        <%= sheet.work_type %>
                    </td>
                    <td style="width:7%">
                        <%= sheet.work_status %>
                    </td>
                    <td style="width:28%">
                        <%= truncate sheet.work_description, length: 100 %>
                    </td>
                    <td>
                        <%= truncate sheet.work_content, length: 100 %>
                    </td>
                </tr>
              <% end %>
          </tbody>
      </table>
      <%= will_paginate @work_sheets,:previous_label => "上一页",:next_label => "下一页" %>
  </div>
</div>
